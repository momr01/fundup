CREATE PROCEDURE [dbo].[RegistrarIngresoPlan]
	@ID_USUARIO int,
	@ID_PLAN int,
	@ID_CATEGORIA int,
	@IMPORTE_DINERO decimal(10,2),
	@DESCRIPCION_DINERO varchar(200),
	@FECHA_DINERO datetime,
	--@FMOVIMIENTO_DINERO datetime,
	@ESTA_ACTIVO_DINERO bit = 1,
	@ES_PLAN bit = 1

AS
BEGIN
	BEGIN TRANSACTION;
	SAVE TRANSACTION SavePoint

	DECLARE @IngresoID int;
	--SET NOCOUNT ON;
	--DECLARE @FECHA_INGRESO datetime
	--SET @FECHA_INGRESO = GETDATE()
	BEGIN TRY
	INSERT INTO [dbo].[INGRESO]
	([ID_USUARIO],
	[ID_CATEGORIA],
	[IMPORTE_INGRESO],
	[DESCRIPCION_INGRESO],
	[FECHA_INGRESO],
	[ESTA_ACTIVO_INGRESO],
	[ES_PLAN])
VALUES (
@ID_USUARIO,
@ID_CATEGORIA,
@IMPORTE_DINERO,
@DESCRIPCION_DINERO,
@FECHA_DINERO,
@ESTA_ACTIVO_DINERO,
@ES_PLAN)
SELECT @IngresoID = SCOPE_IDENTITY()
INSERT INTO PLAN_INGRESO VALUES (@ID_PLAN, @IngresoID) 
COMMIT TRANSACTION
END TRY
BEGIN CATCH
	BEGIN
		ROLLBACK TRANSACTION SavePoint
	END
END CATCH
END


