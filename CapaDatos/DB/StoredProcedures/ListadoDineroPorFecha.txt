CREATE PROCEDURE [dbo].[ListadoDineroPorFecha]
	@idUsuario int,
	@fechaInicial Datetime,
	@fechaFinal Datetime
AS
BEGIN
SET NOCOUNT ON;
	SELECT FECHA_GASTO AS FECHA, DESCRIPCION_GASTO AS DESCRIPCION, 0 AS INGRESO, IMPORTE_GASTO AS GASTO
	FROM GASTO
	WHERE FECHA_GASTO BETWEEN @fechaInicial AND @fechaFinal
	AND ID_USUARIO = @idUsuario
	AND ESTA_ACTIVO_GASTO = 1
	AND ES_PLAN = 0
	UNION
	SELECT FECHA_INGRESO AS FECHA, DESCRIPCION_INGRESO AS DESCRIPCION, IMPORTE_INGRESO AS INGRESO, 0 AS GASTO
	FROM INGRESO
	WHERE FECHA_INGRESO BETWEEN @fechaInicial AND @fechaFinal
	AND ID_USUARIO = @idUsuario
	AND ESTA_ACTIVO_INGRESO = 1
	AND ES_PLAN = 0
	UNION
	SELECT DATEADD(day,1,@fechaFinal) AS FECHA, 'SUBTOTALES' AS DESCRIPCION, (SELECT SUM(i.IMPORTE_INGRESO)
	FROM INGRESO i
	WHERE i.ID_USUARIO = @idUsuario
	AND i.ESTA_ACTIVO_INGRESO = 1
	AND i.ES_PLAN = 0
	AND i.FECHA_INGRESO BETWEEN @fechaInicial AND @fechaFinal
	)  AS INGRESO, (SELECT SUM(g.IMPORTE_GASTO)
	FROM GASTO g
	WHERE g.ID_USUARIO = @idUsuario
	AND g.ESTA_ACTIVO_GASTO = 1
	AND g.ES_PLAN = 0
	AND  g.FECHA_GASTO BETWEEN @fechaInicial AND @fechaFinal
	
	) AS GASTO

	UNION
	SELECT DATEADD(day,2,@fechaFinal) AS FECHA, 'TOTAL' AS DESCRIPCION, ((SELECT SUM(i.IMPORTE_INGRESO)
	FROM INGRESO i
	WHERE i.ID_USUARIO = @idUsuario
	AND i.ESTA_ACTIVO_INGRESO = 1
	AND i.ES_PLAN = 0
	AND i.FECHA_INGRESO BETWEEN @fechaInicial AND @fechaFinal
	) - (SELECT SUM(g.IMPORTE_GASTO)
	FROM GASTO g
	WHERE g.ID_USUARIO = @idUsuario
	AND g.ESTA_ACTIVO_GASTO = 1
	AND g.ES_PLAN = 0
	AND  g.FECHA_GASTO BETWEEN @fechaInicial AND @fechaFinal
	
	)
	) AS INGRESO, 0 AS GASTO
	
	ORDER BY FECHA ASC
END


