CREATE PROCEDURE [dbo].[UltimaFecha]
	@idUsuario int
AS
BEGIN
	SELECT CASE WHEN (
	SELECT ISNULL((SELECT MAX(CAST(FECHA_GASTO AS date)) FROM GASTO
	WHERE ID_USUARIO = @idUsuario
	AND ESTA_ACTIVO_GASTO = 1
	AND ES_PLAN = 0
	GROUP BY ID_USUARIO), NULL) AS ULTIMA_FECHA) 
	> (
	SELECT ISNULL((SELECT MAX(CAST(FECHA_INGRESO AS date)) FROM INGRESO
	WHERE ID_USUARIO = @idUsuario
	AND ESTA_ACTIVO_INGRESO = 1
	AND ES_PLAN = 0
	GROUP BY ID_USUARIO), NULL) AS ULTIMA_FECHA) 
	THEN (
	SELECT ISNULL((SELECT MAX(CAST(FECHA_GASTO AS date)) FROM GASTO
	WHERE ID_USUARIO = @idUsuario
	AND ESTA_ACTIVO_GASTO = 1
	AND ES_PLAN = 0
	GROUP BY ID_USUARIO), NULL) AS ULTIMA_FECHA) 
	ELSE (
	SELECT ISNULL((SELECT MAX(CAST(FECHA_INGRESO AS date)) FROM INGRESO
	WHERE ID_USUARIO = @idUsuario
	AND ESTA_ACTIVO_INGRESO = 1
	AND ES_PLAN = 0
	GROUP BY ID_USUARIO), NULL) AS ULTIMA_FECHA)
END AS ULTIMA_FECHA
END